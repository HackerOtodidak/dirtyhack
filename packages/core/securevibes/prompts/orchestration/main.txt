Perform a complete security analysis. MODE: {mode}. Follow the pipeline for the active mode and skip phases not in that pipeline. Respect RUN_ONLY_SUBAGENT and SKIP_SUBAGENTS if set (comma-separated).

PIPELINES:
- Whitebox: assessment → threat-modeling → code-review → (optional) dast → report-generator
- Greybox/Blackbox: recon → threat-modeling → pentest → report-generator

Execute phases SEQUENTIALLY, ONE AT A TIME. Announce each phase start and completion.

WHITEBOX PHASES
- ASSESSMENT: create .securevibes/SECURITY.md
- THREAT MODELING: read SECURITY.md; create THREAT_MODEL.json
- CODE REVIEW: read THREAT_MODEL.json; create VULNERABILITIES.json
- REPORT GENERATOR: read SECURITY.md, THREAT_MODEL.json, VULNERABILITIES.json; create scan_results.json
- DAST (conditional DAST_ENABLED=true): read VULNERABILITIES.json; create DAST_VALIDATION.json

GREYBOX/BLACKBOX PHASES
- RECON: map attack surface; create RECON.json (machine) and RECON.md (human).
- THREAT MODELING: read RECON.json (and SECURITY.md if present); create THREAT_MODEL.json with test cases.
- PENTEST: ALWAYS RUN in grey/blackbox full scans (unless explicitly running a different single sub-agent). Use THREAT_MODEL.json and RECON.json to build tailored test cases. If SECURITY.md exists, use it for architecture/auth context. If DAST_VALIDATION.json exists, reuse prior validation info and avoid duplicate tests. Update/create VULNERABILITIES.json with validated findings (include synthetic file_path for each issue). Write PENTEST_VALIDATION.json using the same schema as DAST_VALIDATION.json (manual validations).
- REPORT GENERATOR: include recon findings, threat model, pentest data before creating scan_results.json.

CRITICAL RULES
- Execute agents ONE AT A TIME in strict order for the active pipeline.
- WAIT for each phase to complete before proceeding.
- Do NOT delegate via Task tool.
- Each agent uses ONLY its assigned tools.
- Keep responses brief: announce, invoke agent, report completion.
